{% extends "base.html" %}

{% block title %}Log Workout - Workout Tracker{% endblock %}

{% block content %}
<div class="log-workout">
    <h1>Log Workout</h1>
    
    <form method="POST" action="{{ url_for('workout.log_workout') }}" id="workoutForm">
        <div class="form-section">
            <h2>Workout Details</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="workout_name">Workout Name</label>
                    <input 
                        type="text" 
                        id="workout_name" 
                        name="workout_name" 
                        class="form-control" 
                        value="{{ today_workout.split_name }}"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="date">Date</label>
                    <input 
                        type="date" 
                        id="date" 
                        name="date" 
                        class="form-control" 
                        value="{{ today_date }}"
                        required
                    >
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="week_number">Week in Cycle</label>
                    <input 
                        type="number" 
                        id="week_number" 
                        name="week_number" 
                        class="form-control" 
                        value="{{ today_workout.week_in_cycle }}"
                        min="1" 
                        max="4"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="split">Split</label>
                    <select id="split" name="split" class="form-control" required>
                        <option value="A" {% if today_workout.split == 'A' %}selected{% endif %}>A</option>
                        <option value="B" {% if today_workout.split == 'B' %}selected{% endif %}>B</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="notes">Notes (optional)</label>
                <textarea 
                    id="notes" 
                    name="notes" 
                    class="form-control" 
                    rows="2"
                    placeholder="How did you feel? Any observations?"
                ></textarea>
            </div>
        </div>

        <div class="form-section">
            <h2>Exercises</h2>
            <div id="exercisesContainer">
                {% for exercise in today_workout.exercises %}
                <div class="exercise-card" data-exercise-index="{{ loop.index0 }}">
                    <h3>{{ exercise.name }}</h3>
                    <input 
                        type="hidden" 
                        name="exercise_{{ loop.index0 }}_name" 
                        value="{{ exercise.name }}"
                    >
                    
                    <div class="sets-container" data-exercise-index="{{ loop.index0 }}">
                        {% for set in range(exercise.sets) %}
                        <div class="set-row">
                            <span class="set-label">Set {{ loop.index }}</span>
                            <input 
                                type="number" 
                                name="exercise_{{ loop.index0 }}_set_{{ loop.index0 }}_reps" 
                                placeholder="Reps ({{ exercise.reps }})"
                                class="form-control set-input"
                                min="1"
                                required
                            >
                            <input 
                                type="number" 
                                name="exercise_{{ loop.index0 }}_set_{{ loop.index0 }}_weight" 
                                placeholder="Weight (kg)"
                                class="form-control set-input"
                                step="0.5"
                                min="0"
                                required
                            >
                            <input 
                                type="number" 
                                name="exercise_{{ loop.index0 }}_set_{{ loop.index0 }}_rpe" 
                                placeholder="RPE (1-10)"
                                class="form-control set-input"
                                step="0.5"
                                min="1"
                                max="10"
                            >
                        </div>
                        {% endfor %}
                    </div>
                    
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addSet({{ loop.index0 }})">
                        Add Another Set
                    </button>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Workout</button>
            <a href="{{ url_for('workout.dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
function addSet(exerciseIndex) {
    const container = document.querySelector(`.sets-container[data-exercise-index="${exerciseIndex}"]`);
    const setCount = container.querySelectorAll('.set-row').length;
    
    const setRow = document.createElement('div');
    setRow.className = 'set-row';
    setRow.innerHTML = `
        <span class="set-label">Set ${setCount + 1}</span>
        <input 
            type="number" 
            name="exercise_${exerciseIndex}_set_${setCount}_reps" 
            placeholder="Reps"
            class="form-control set-input"
            min="1"
            required
        >
        <input 
            type="number" 
            name="exercise_${exerciseIndex}_set_${setCount}_weight" 
            placeholder="Weight (kg)"
            class="form-control set-input"
            step="0.5"
            min="0"
            required
        >
        <input 
            type="number" 
            name="exercise_${exerciseIndex}_set_${setCount}_rpe" 
            placeholder="RPE (1-10)"
            class="form-control set-input"
            step="0.5"
            min="1"
            max="10"
        >
    `;
    
    container.appendChild(setRow);
}
</script>
{% endblock %}
